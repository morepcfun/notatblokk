<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>WebNotater</title>
<style>
body {
font-family: monospace;
background-color: #121212;
color: #eeeeee;
display: flex;
flex-direction: column;
align-items: center;
}
#toolbar {
display: flex;
flex-wrap: wrap;
gap: 8px;
background: #181818;
border-radius: 12px 12px 0 0;
padding: 10px 12px 6px 12px;
max-width: 768px;
width: 100%;
margin-left: auto;
margin-right: auto;
margin-bottom: 0.5rem;
justify-content: center;
align-items: center;
box-sizing: border-box;
position: sticky;
top: 0;
z-index: 100;
}
#toolbar button {
background: #232323;
color: #eee;
border: 1px solid #333;
border-radius: 8px;
padding: 6px 16px;
font-size: 1rem;
cursor: pointer;
transition: background 0.2s, box-shadow 0.2s;
min-width: 38px;
min-height: 38px;
display: flex;
align-items: center;
justify-content: center;
box-sizing: border-box;
}
#toolbar button:hover {
background: #333;
box-shadow: 0 2px 8px 0 #0002;
}
button:hover {
background-color: #444;
}
#notepad {
max-width: 768px;
width: 100%;
min-height: 500px;
padding: 20px;
background-color: #222;
border: 1px solid #444;
color: #eee;
font-size: 1rem;
line-height: 1.5;
border-radius: 14px;
box-sizing: border-box;
}
#notepad a {
color: #7ecbff;
text-decoration: underline;
transition: color 0.2s;
}
#notepad a:hover {
color: #b3e0ff;
}
#notepad pre {
 background: #111;
 border: 1px solid #333;
 padding: 1em;
 border-radius: 8px;
 white-space: pre-wrap;
}
.save-button {
background-color: #2c2c2c;
color: #e0e0e0;
border: none;
padding: 10px 20px;
border-radius: 5px;
font-family: sans-serif;
cursor: pointer;
transition: background-color 0.3s ease, transform 0.2s ease;
margin-top: 20px;
margin-bottom: 40px;
}
</style>
</head>
<body>
<div id="opened-filename" style="width:100%;max-width:768px;margin:0 auto 6px auto;text-align:center;color:#7ecbff;font-size:0.95rem;display:none;">
</div>
<div id="toolbar">
<button type="button" id="open-btn" title="√Öpne fil">üìÇ</button>
<button type="button" title="Fet (Ctrl+B)" onclick="format('bold')"><b>B</b></button>
<button type="button" title="Kursiv (Ctrl+I)" onclick="format('italic')"><i>I</i></button>
<button type="button" title="Understreket (Ctrl+U)" onclick="format('underline')"><u>U</u></button>
<button type="button" title="Gjennomstreking" onclick="format('strikeThrough')"><s>S</s></button>
<button type="button" title="Overskrift" onclick="formatBlock('H2')">H2</button>
<button type="button" title="Punktliste" onclick="format('insertUnorderedList')">‚Ä¢ Liste</button>
<button type="button" title="Nummerert liste" onclick="format('insertOrderedList')">1. Liste</button>
<button type="button" title="Venstrejuster" onclick="format('justifyLeft')">L</button>
<button type="button" title="Midtstill" onclick="format('justifyCenter')">M</button>
<button type="button" title="H√∏yrejuster" onclick="format('justifyRight')">H</button>
<button type="button" title="Kodeblokk" onclick="formatBlock('pre')">&lt; &gt;</button>
<button type="button" title="Lenke" onclick="insertLink()">üîó</button>
<button type="button" title="Bilde" onclick="triggerImageUpload()">üñºÔ∏è</button>
<input type="file" id="image-upload" accept="image/*" style="display:none" />
<button type="button" title="Angre (Ctrl+Z)" onclick="format('undo')">‚Ü∫</button>
<button type="button" title="Gj√∏r om (Ctrl+Y)" onclick="format('redo')">‚Üª</button>
<button type="button" title="Fjern formatering" onclick="clearFormatting()">üßπ</button>
</div>
<div id="notepad" contenteditable="true" role="main"></div>
<div id="controls">
<button class="save-button" id="save-btn"></button>
<button class="save-button" id="clear-btn"></button>
</div>
<script>
const lang = {
    save: "Lagre",
    clear: "T√∏m",
    opened: "√Öpnet:",
    unableToOpen: "Kunne ikke √•pne. Filen er ikke laget med WebNotater.",
    enterURL: "Skriv inn URL:",
    noteTitle: "Mitt Notat",
    fullSizeImage: "Full St√∏rrelse Bilde"
};

const notepad = document.getElementById('notepad');
const openBtn = document.getElementById('open-btn');
const imageUpload = document.getElementById('image-upload');
const openedFilename = document.getElementById('opened-filename');

function format(command, value = null) {
    document.execCommand(command, false, value);
    notepad.focus();
};

function formatBlock(tag) {
    let sel = window.getSelection();
    if (sel.rangeCount > 0) {
        let container = sel.getRangeAt(0).commonAncestorContainer;
        if (container.nodeType === 3) container = container.parentNode;
        if (container && container.closest && container.closest(tag.toLowerCase())) {
            document.execCommand('formatBlock', false, 'P');
        } else {
            document.execCommand('formatBlock', false, tag);
        }
    }
    notepad.focus();
};

function insertLink() {
    let url = prompt(lang.enterURL, 'https://');
    if (url) format('createLink', url);
};

function triggerImageUpload() {
    imageUpload.click();
};

function clearFormatting() {
    const sel = window.getSelection();
    if (!sel.isCollapsed) {
        const range = sel.getRangeAt(0);
        const tempDiv = document.createElement('div');
        tempDiv.appendChild(range.cloneContents());
        document.execCommand('insertText', false, tempDiv.innerText);
    } else {
        document.execCommand('removeFormat', false, null);
    }
    notepad.focus();
};

function saveNotes() {
    const fileName = `notat.html`;
    const content = notepad.innerHTML;
    const newHtml = `
<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<title>${lang.noteTitle}</title>
<style>
body { font-family: monospace; background-color: #121212; color: #eeeeee; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; }
#notepad { max-width: 768px; width: 100%; padding: 20px; background-color: #222; border: 1px solid #444; color: #eee; font-size: 1rem; line-height: 1.5; border-radius: 14px; box-sizing: border-box; margin: 20px auto; }
#notepad img { max-width: 100%; height: auto; display: block; margin: 8px 0; cursor: pointer; }
#notepad a { color: #7ecbff; text-decoration: underline; transition: color 0.2s; }
#notepad a:hover { color: #b3e0ff; }
#notepad pre { background: #111; border: 1px solid #333; padding: 1em; border-radius: 8px; white-space: pre-wrap; }
</style>
</head>
<body>
<div id="notepad">${content}</div>
<script>
document.getElementById('notepad').addEventListener('click', function(e) {
    if (e.target.tagName === 'IMG' && e.target.src.startsWith('data:image')) {
        const imageData = e.target.src;
        const newPageContent = \`
<!DOCTYPE html>
<html>
<head><title>${lang.fullSizeImage}</title><style>body{margin:0;background-color:#121212;display:flex;justify-content:center;align-items:center;height:100vh;}img{max-width:100%;max-height:100vh;object-fit:contain;}</style></head>
<body><img src="\${imageData}" alt="${lang.fullSizeImage}"></body></html>\`;
        const blob = new Blob([newPageContent], { type: 'text/html' });
        window.open(URL.createObjectURL(blob), '_blank');
    }
});
// <\/script>
</body>
</html>`;
    const blob = new Blob([newHtml], { type: 'text/html' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = fileName;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function clearNotes() {
    notepad.innerHTML = '';
}

function insertImageFromReader(event) {
    const img = document.createElement('img');
    img.style.maxWidth = '100%';
    img.style.height = 'auto';
    img.style.display = 'block';
    img.style.margin = '8px 0';
    
    const tempImg = new Image();
    tempImg.onload = function () {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const maxWidth = 768; // Max width inside notepad
        const scaleFactor = tempImg.width > maxWidth ? maxWidth / tempImg.width : 1;
        
        canvas.width = tempImg.width * scaleFactor;
        canvas.height = tempImg.height * scaleFactor;
        
        ctx.drawImage(tempImg, 0, 0, canvas.width, canvas.height);
        
        img.src = canvas.toDataURL('image/jpeg', 0.9);
        document.execCommand('insertHTML', false, img.outerHTML);
    };
    tempImg.src = event.target.result;
}

window.addEventListener('DOMContentLoaded', function () {
    document.getElementById('save-btn').textContent = lang.save;
    document.getElementById('clear-btn').textContent = lang.clear;
    document.getElementById('save-btn').onclick = saveNotes;
    document.getElementById('clear-btn').onclick = clearNotes;

    openBtn.addEventListener('click', function () {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.html';
        fileInput.style.display = 'none';
        document.body.appendChild(fileInput);
        fileInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (event) {
                const content = event.target.result;
                notepad.innerHTML = '';
                openedFilename.style.display = 'none';
                if (content.includes('')) {
                    const doc = new DOMParser().parseFromString(content, 'text/html');
                    const loadedNotepad = doc.getElementById('notepad');
                    notepad.innerHTML = loadedNotepad ? loadedNotepad.innerHTML : '';
                    openedFilename.textContent = `${lang.opened} ${file.name}`;
                    openedFilename.style.display = 'block';
                } else {
                    alert(lang.unableToOpen);
                }
            };
            reader.readAsText(file);
            document.body.removeChild(fileInput);
        });
        fileInput.click();
    });

    imageUpload.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = insertImageFromReader;
        reader.readAsDataURL(file);
        e.target.value = '';
    });

    notepad.addEventListener('keydown', function (e) {
        if (e.ctrlKey && !e.shiftKey) {
            switch (e.key.toLowerCase()) {
                case 'b': e.preventDefault(); format('bold'); break;
                case 'i': e.preventDefault(); format('italic'); break;
                case 'u': e.preventDefault(); format('underline'); break;
                case 'z': e.preventDefault(); format('undo'); break;
                case 'y': e.preventDefault(); format('redo'); break;
            }
        }
    });

    notepad.addEventListener('paste', function (e) {
        for (const item of (e.clipboardData || e.originalEvent.clipboardData).items) {
            if (item.type.startsWith('image/')) {
                e.preventDefault();
                const blob = item.getAsFile();
                const reader = new FileReader();
                reader.onload = insertImageFromReader;
                reader.readAsDataURL(blob);
            }
        }
    });
});
</script>
</body>
</html>